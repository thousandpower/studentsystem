<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jxd.jqstudentgrowthtrackingsystem.dao.IStudentDao">
    <!--查询学员id，作为用户的id-->
    <select id="selectId" resultType="Student">
        select studentid from student
        where student_name = #{studentName}
        and id_number = #{idNumber}
    </select>
    <!--批量删除用户，只是不显示用户信息，不删除信息-->
    <update id="deleteAnyStudents">
        update student set flag = 1
        where studentid in
        <foreach collection="array" separator="," open="(" close=")" item="studentid">
            #{studentid}
        </foreach>
    </update>
    <!--查询这名学员的培训学校评价-->
    <select id="selectThisStudentSchoolEvaluation" resultType="java.util.HashMap">
        select st.studentid,st.student_name,co.html,co.oracle,
        co.js,co.java_base,co.java_high,co.l1,te.teacherid,
        te.username,sc.appraisal_score,sc.gradeid,sc.appraisal_content
        from student st
        left join course_score co on co.studentid = st.studentid
        left join school_evaluation sc on sc.studentid = st.studentid
        left join teacher te on te.teacherid = sc.evaluatorid
        where st.studentid = #{studentid}
    </select>
    <!--查询这名学员的从转正到工作三年的部门评价-->
    <select id="selectThisStudentDeptEvaluation" resultType="java.util.HashMap">
        select den.appraisal_score,den.appraisal_content,de.deptname,
        jo.jobname,des.ability,des.initiative,des.communication,des.moral_quality,
        des.characters,der.username
        from dept_evaluation den
        LEFT JOIN dept_evaluation_items des on des.studentid = den.studentid and des.work_year = den.work_year
        LEFT JOIN dept_evaluator der on der.evaluatorid = den.evaluatorid
        LEFT JOIN dept de on de.deptno = den.deptno
        LEFT JOIN job jo on jo.jobid = den.jobid
        where den.studentid = #{studentid}
        and den.work_year = #{workYear}
    </select>
    <!--查询所有学员，列表展示-->
    <select id="selectAllStudent" resultType="java.util.HashMap">
        select studentid,student_name,sex,nation,birthday,native_place,
        marital_status,phone,id_number,college,major,gradeid
        from student
        where flag = 0
        <if test="studentName != null and studentName !=''">
            and student_name like concat('%',#{studentName},'%')
        </if>
        <if test="gradeid != '全部' and gradeid != null and gradeid !=''">
            and gradeid = #{gradeid}
        </if>
        order by gradeid desc
    </select>
</mapper>